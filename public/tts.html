<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title> LLM | æ™ºèƒ½æ–‡æœ¬è½¬è¯­éŸ³</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <a href="/" class="page-switch-link" title="åˆ‡æ¢åˆ°è¯­éŸ³è½¬æ–‡å­— (STT)">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z" />
        </svg>
    </a>
    <a href="https://github.com/QAbot-zh/VoiceHub" target="_blank" rel="noopener noreferrer" class="github-link"
        title="æŸ¥çœ‹ GitHub ä»“åº“">
        <svg viewBox="0 0 16 16" version="1.1" aria-hidden="true">
            <path fill-rule="evenodd"
                d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.67.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
            </path>
        </svg>
    </a>
    <div class="container">
        <header>
            <h1><span>LLM</span> æ–‡æœ¬è½¬è¯­éŸ³</h1>
        </header>

        <div class="card">
            <div class="card-header">
                <div class="icon-box">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" />
                    </svg>
                </div>
                <h2>è¾“å…¥æ–‡æœ¬å¹¶é€‰æ‹©å‚æ•°</h2>
                <div id="authSection" style="display:flex; align-items:center; gap:8px;">
                    <button type="button" id="verifyBtn" class="verify-btn">å£ä»¤éªŒè¯</button>
                </div>
            </div>

            <form id="ttsForm">
                <div class="form-group">
                    <label for="textInput">è¾“å…¥æ–‡æœ¬ (å»ºè®®é•¿åº¦é€‚ä¸­)</label>
                    <textarea id="textInput" name="textInput" placeholder="åœ¨æ­¤è¾“å…¥è¦è½¬æ¢ä¸ºè¯­éŸ³çš„æ–‡æœ¬ï¼Œè¿‡é•¿çš„æ–‡æœ¬å¯èƒ½å¯¼è‡´åˆæˆå¤±è´¥æˆ–å“åº”ç¼“æ…¢..."
                        required></textarea>
                    <div id="charCount">0</div>
                </div>

                <div class="parameter-controls-row">
                    <div class="form-group">
                        <label for="modelSelect">é€‰æ‹©æ¨¡å‹</label>
                        <select id="modelSelect" name="model">
                            <optgroup label="OpenAI TTS" id="openai-models">
                                <option value="gpt-4o-mini-tts">GPT-4o Mini TTS (æ¨è)</option>
                                <option value="tts-1">TTS-1 (æ ‡å‡†)</option>
                                <option value="tts-1-hd">TTS-1-HD (é«˜æ¸…)</option>
                            </optgroup>

                            <optgroup label="Google Gemini" id="gemini-models">
                                <option value="gemini-2.5-flash-preview-tts">Gemini 2.5 Flash TTS</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="voiceSelect">é€‰æ‹©å£°éŸ³</label>
                        <select id="voiceSelect" name="voice">
                        </select>
                    </div>
                </div>
                <!-- Gemini TTS é£æ ¼æç¤º -->
                <details id="gemini-style-tip" class="tip hidden">
                <summary>ğŸ’¡ Gemini TTS æ”¯æŒé£æ ¼æ§åˆ¶ï¼ˆç‚¹æ­¤å±•å¼€ç¤ºä¾‹ï¼‰</summary>
                <div class="tip-body">
                    <p>åœ¨æ–‡æœ¬å‰æ·»åŠ è‡ªç„¶è¯­è¨€æŒ‡ä»¤å³å¯æ§åˆ¶<strong>è¯­æ°”ã€è¯­è¨€ã€èŠ‚å¥ã€éŸ³è°ƒ</strong>ç­‰ã€‚</p>

                    <!-- ä¸€é”®å‰ç¼€ï¼ˆå¯é€‰ï¼‰ -->
                    <h4 style="margin-top:12px">ä¸€é”®å‰ç¼€</h4>
                    <div class="chips">
                    <button type="button" class="chip" data-style="Say cheerfully: ">æ„‰å¿«</button>
                    <button type="button" class="chip" data-style="Speak in a calm, storytelling tone: ">å™äº‹</button>
                    <button type="button" class="chip" data-style="Use a slow pace with a gentle whisper: ">è½»å£°æ…¢é€Ÿ</button>
                    <button type="button" class="chip" data-style="With a British accent: ">è‹±å¼å£éŸ³</button>
                    </div>

                    <h4 style="margin-top:12px">é«˜çº§ç¤ºä¾‹</h4>
                    <!-- æ§åˆ¶å†…å®¹ -->
                    <div class="example-box">
                    <div class="example-title">æ§åˆ¶å†…å®¹</div>
                    <textarea class="example" readonly rows="4">First say, "å…¨æ°‘åˆ¶ä½œäººå¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç»ƒä¹ æ—¶é•¿ä¸¤å¹´åŠçš„ä¸ªäººç»ƒä¹ ç”Ÿå“ˆåŸºç±³", with a brief laugh, then after two seconds say, "å–œæ¬¢å”±ã€è·³ã€rapã€ç¯®çƒ".</textarea>
                    <div class="example-actions">
                        <button type="button" class="example-insert">æ’å…¥åˆ°æ–‡æœ¬æ¡†</button>
                        <button type="button" class="example-copy">å¤åˆ¶</button>
                    </div>
                    </div>

                    <!-- æŒ‡å®šè¯­è¨€ -->
                    <div class="example-box">
                    <div class="example-title">æŒ‡å®šè¯­è¨€</div>
                    <textarea class="example" readonly rows="4">ç”¨ç²¤è¯­åˆæˆè¿™æ®µè¯ï¼š 
"å…¨æ°‘åˆ¶ä½œäººå¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç»ƒä¹ æ—¶é•¿ä¸¤å¹´åŠçš„ä¸ªäººç»ƒä¹ ç”Ÿå“ˆåŸºç±³,å–œæ¬¢å”±ã€è·³ã€rapã€ç¯®çƒ"</textarea>
                    <div class="example-actions">
                        <button type="button" class="example-insert">æ’å…¥åˆ°æ–‡æœ¬æ¡†</button>
                        <button type="button" class="example-copy">å¤åˆ¶</button>
                    </div>
                    </div>

                    <!-- æŒ‡å®šé£æ ¼ -->
                    <div class="example-box">
                        <div class="example-title">æŒ‡å®šé£æ ¼ï¼ˆæå¿«è¯­é€Ÿï¼‰</div>
                        <textarea class="example" readonly rows="4">Read this opening in as fast a voice as possible while remaining intelligible: 
"å…¨æ°‘åˆ¶ä½œäººå¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç»ƒä¹ æ—¶é•¿ä¸¤å¹´åŠçš„ä¸ªäººç»ƒä¹ ç”Ÿå“ˆåŸºç±³,å–œæ¬¢å”±ã€è·³ã€rapã€ç¯®çƒ"</textarea>
                        <div class="example-actions">
                            <button type="button" class="example-insert">æ’å…¥åˆ°æ–‡æœ¬æ¡†</button>
                            <button type="button" class="example-copy">å¤åˆ¶</button>
                        </div>
                    </div>

                    <p class="note">è¯´æ˜ï¼šä¸Šè¿°ç¤ºä¾‹ä»… <strong>Gemini TTS </strong>æ”¯æŒï¼Œä¸­æ–‡æŒ‡ä»¤ç†è§£å¼±äºè‹±æ–‡æŒ‡ä»¤ï¼Œå¯èƒ½å‡ºç°ä¸éµå¾ªæŒ‡ä»¤ã€ç›´æ¥åˆæˆè¾“å…¥æ–‡æœ¬çš„æƒ…å†µã€‚</p>
                </div>
                </details>
                <div style="margin-top: 24px; text-align: center;">
                    <button class="btn" type="submit" id="submitBtn">å¼€å§‹è¯­éŸ³åˆæˆ</button>
                </div>
            </form>

            <div id="status">
                <div class="spinner"></div>
                <div>AIæ­£åœ¨åˆæˆä¸­...<span id="timer">0s</span></div>
            </div>
        </div>

        <div id="resultContainer" class="result-container card">
            <div class="card-header result">
                <div class="icon-box success">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z" />
                    </svg>
                </div>
                <h2>åˆæˆç»“æœ</h2>
                <a id="downloadBtn" href="#" download="speech.mp3">ä¸‹è½½éŸ³é¢‘</a>
            </div>
            <audio id="audioPlayer" controls></audio>
        </div>
    </div>

    <script>
        let isVerified = false;
        let timerInterval;
        const AUTH_KEY = 'SF_AUTH_TOKEN';

        const verifyBtn = document.getElementById('verifyBtn');
        const ttsForm = document.getElementById('ttsForm');
        const submitBtn = document.getElementById('submitBtn');
        const statusDiv = document.getElementById('status');
        const textInput = document.getElementById('textInput');
        const modelSelect = document.getElementById('modelSelect');
        const voiceSelect = document.getElementById('voiceSelect');
        const openaiOptgroup = document.getElementById('openai-models');
        const geminiOptgroup = document.getElementById('gemini-models');
        const charCountDiv = document.getElementById('charCount');
        const timerSpan = document.getElementById('timer');

        const resultContainer = document.getElementById('resultContainer');
        const audioPlayer = document.getElementById('audioPlayer');
        const downloadBtn = document.getElementById('downloadBtn');

        const voiceMap = {
            openai: [
                { value: "alloy", label: "Alloy â€“ å‡è¡¡ç™¾æ­Â·é€šç”¨" },
                { value: "ash", label: "Ash â€“ æ¸…æ™°æ˜äº†Â·å•†åŠ¡" },
                { value: "ballad", label: "Ballad â€“ å¹³æ»‘æ‚¦è€³Â·æ•…äº‹" },
                { value: "coral", label: "Coral â€“ æ¸©æš–å‹å¥½Â·æ•™ç¨‹" },
                { value: "echo", label: "Echo â€“ æ´ªäº®æ¸…æ™°Â·å…¬å‘Š" },
                { value: "fable", label: "Fable â€“ ç”ŸåŠ¨æ´»åŠ›Â·å¨±ä¹" },
                { value: "nova", label: "Nova â€“ æœæ°”è“¬å‹ƒÂ·è¥é”€" },
                { value: "onyx", label: "Onyx â€“ æ·±æ²‰æƒå¨Â·æ–°é—»" },
                { value: "sage", label: "Sage â€“ ç¿æ™ºæ²‰ç¨³Â·æ•™è‚²" },
                { value: "shimmer", label: "Shimmer â€“ è½»å¿«ç©ºçµÂ·ä¼‘é—²" },
                { value: "verse", label: "Verse â€“ æŠ‘æ‰¬é¡¿æŒ«Â·è¯—æ­Œ" },
            ],
            gemini: [
                { value: "Zephyr", label: "Zephyr â€“ æ˜äº®Â·é«˜éŸ³" },
                { value: "Puck", label: "Puck â€“ ä¹è§‚Â·ä¸­éŸ³" },
                { value: "Charon", label: "Charon â€“ ä¿¡æ¯ä¸°å¯ŒÂ·ä½éŸ³" },
                { value: "Kore", label: "Kore â€“ åšå®šÂ·ä¸­éŸ³" },
                { value: "Fenrir", label: "Fenrir â€“ å…´å¥‹Â·åä½ä¸­éŸ³" },
                { value: "Leda", label: "Leda â€“ å¹´è½»Â·é«˜éŸ³" },
                { value: "Orus", label: "Orus â€“ åšå®šÂ·åä½ä¸­éŸ³" },
                { value: "Aoede", label: "Aoede â€“ è½»ç›ˆÂ·ä¸­éŸ³" },
                { value: "Callirrhoe", label: "Callirrhoe â€“ éšå’ŒÂ·ä¸­éŸ³" },
                { value: "Autonoe", label: "Autonoe â€“ æ˜äº®Â·ä¸­éŸ³" },
                { value: "Enceladus", label: "Enceladus â€“ é€šé€æ°”æ¯Â·ä½éŸ³" },
                { value: "Iapetus", label: "Iapetus â€“ æ¸…æ™°Â·åä½ä¸­éŸ³" },
                { value: "Umbriel", label: "Umbriel â€“ éšå’ŒÂ·åä½ä¸­éŸ³" },
                { value: "Algieba", label: "Algieba â€“ åœ†æ¶¦Â·ä½éŸ³" },
                { value: "Despina", label: "Despina â€“ åœ†æ¶¦Â·ä¸­éŸ³" },
                { value: "Erinome", label: "Erinome â€“ æ¸…æ™°Â·ä¸­éŸ³" },
                { value: "Algenib", label: "Algenib â€“ æ²™å“‘Â·ä½éŸ³" },
                { value: "Rasalgethi", label: "Rasalgethi â€“ ä¿¡æ¯ä¸°å¯ŒÂ·ä¸­éŸ³" },
                { value: "Laomedeia", label: "Laomedeia â€“ ä¹è§‚Â·é«˜éŸ³" },
                { value: "Achernar", label: "Achernar â€“ æŸ”å’ŒÂ·é«˜éŸ³" },
                { value: "Alnilam", label: "Alnilam â€“ åšå®šÂ·åä½ä¸­éŸ³" },
                { value: "Schedar", label: "Schedar â€“ å‡è¡¡Â·åä½ä¸­éŸ³" },
                { value: "Gacrux", label: "Gacrux â€“ æ²‰ç¨³Â·ä¸­éŸ³" },
                { value: "Pulcherrima", label: "Pulcherrima â€“ ä¸»åŠ¨Â·ä¸­éŸ³" },
                { value: "Achird", label: "Achird â€“ å‹å¥½Â·åä½ä¸­éŸ³" },
                { value: "Zubenelgenubi", label: "Zubenelgenubi â€“ ä¼‘é—²Â·åä½ä¸­éŸ³" },
                { value: "Vindemiatrix", label: "Vindemiatrix â€“ æ¸©å’ŒÂ·ä¸­éŸ³" },
                { value: "Sadachbia", label: "Sadachbia â€“ æ´»æ³¼Â·ä½éŸ³" },
                { value: "Sadaltager", label: "Sadaltager â€“ åšå­¦Â·ä¸­éŸ³" },
                { value: "Sulafat", label: "Sulafat â€“ æ¸©æš–Â·ä¸­éŸ³" },
            ]
        };
        function refreshVoices() {
            const isGemini = modelSelect.value.startsWith("gemini");
            const list = isGemini ? voiceMap.gemini : voiceMap.openai;

            voiceSelect.innerHTML = list
                .map(({ value, label }) => `<option value="${value}">${label}</option>`)
                .join("");
        }

        modelSelect.addEventListener("change", refreshVoices);
        refreshVoices();

        function checkAuthStatus() {
            const authToken = localStorage.getItem(AUTH_KEY);
            if (authToken) {
                const [tsStr] = authToken.split('.');
                const ts = parseInt(tsStr, 10) * 1000;
                const isExpired = (Date.now() - ts) > 30 * 24 * 60 * 60 * 1000;
                isVerified = !isExpired;
                updateAuthUI(isVerified);
            } else {
                updateAuthUI(false);
            }
        }

        function updateAuthUI(verified) {
            if (verified) {
                verifyBtn.textContent = 'å£ä»¤å·²éªŒè¯';
                verifyBtn.classList.add('verified');
                submitBtn.disabled = false;
                submitBtn.title = '';
            } else {
                verifyBtn.textContent = 'å£ä»¤æœªéªŒè¯æˆ–è¿‡æœŸ';
                verifyBtn.classList.remove('verified');
                submitBtn.disabled = true;
                submitBtn.title = 'è¯·å…ˆå®Œæˆå£ä»¤éªŒè¯';
            }
        }

        verifyBtn.addEventListener('click', async () => {
            if (isVerified) {
                const action = confirm('å½“å‰å·²éªŒè¯é€šè¿‡ï¼Œæ˜¯å¦è¦é€€å‡ºç™»å½•ï¼Ÿ');
                if (action) {
                    isVerified = false;
                    localStorage.removeItem(AUTH_KEY);
                    updateAuthUI(false);
                }
                return;
            }

            const tokenPrompt = prompt('è¯·è¾“å…¥å£ä»¤ï¼š');
            if (!tokenPrompt) return;

            try {
                // Assuming your verify endpoint is at /verify (same as STT)
                const res = await fetch('/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token: tokenPrompt })
                });
                const { valid, auth_token } = await res.json();
                isVerified = valid;

                if (valid) {
                    localStorage.setItem(AUTH_KEY, auth_token);
                    updateAuthUI(true);
                } else {
                    alert('å£ä»¤é”™è¯¯');
                }
            } catch (err) {
                console.error('éªŒè¯å¤±è´¥:', err);
                alert('éªŒè¯å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
            }
        });

        textInput.addEventListener('input', () => {
            const count = textInput.value.length;
            charCountDiv.textContent = `${count}`;
            if (isVerified) {
                submitBtn.disabled = false;
            }
        });

        ttsForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isVerified) {
                alert('è¯·å…ˆå®Œæˆå£ä»¤éªŒè¯');
                return;
            }

            const text = textInput.value.trim();
            if (!text) {
                alert('è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬');
                return;
            }

            const model = modelSelect.value;
            const voice = voiceSelect.value;
            const authToken = localStorage.getItem(AUTH_KEY);

            submitBtn.disabled = true;
            submitBtn.title = '';
            statusDiv.classList.add('active');
            resultContainer.classList.remove('active');
            downloadBtn.classList.remove('visible');
            audioPlayer.src = '';

            let seconds = 0;
            timerSpan.textContent = '0s';
            timerInterval = setInterval(() => {
                seconds++;
                timerSpan.textContent = `${seconds}s`;
            }, 1000);


            try {
                // This will be the new worker endpoint for TTS
                const response = await fetch('/speech', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Auth-Token': authToken
                    },
                    body: JSON.stringify({
                        model: model,
                        input: text,
                        voice: voice
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: 'åˆæˆå¤±è´¥ï¼Œæ— æ³•è§£æé”™è¯¯ä¿¡æ¯ã€‚' }));
                    throw new Error(errorData.error || `åˆæˆå¤±è´¥ (çŠ¶æ€ç : ${response.status})`);
                }

                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                audioPlayer.src = audioUrl;

                // Attempt to play audio immediately
                audioPlayer.play().catch(error => {
                    console.warn("Autoplay was prevented:", error);
                });

                // Determine file extension based on content type
                const contentType = response.headers.get("Content-Type");
                let fileExtension = "mp3"; // Default
                if (contentType === "audio/mpeg") {
                    fileExtension = "mp3";
                } else if (contentType === "audio/wav") {
                    fileExtension = "wav";
                } else if (contentType === "audio/opus") {
                    fileExtension = "opus";
                } else if (contentType === "audio/flac") {
                    fileExtension = "flac";
                }

                downloadBtn.href = audioUrl;
                downloadBtn.download = `speech.${fileExtension}`;

                resultContainer.classList.add('active');
                downloadBtn.classList.add('visible');

            } catch (err) {
                console.error('è¯­éŸ³åˆæˆå‡ºé”™:', err);
                alert(`é”™è¯¯: ${err.message}`);
                resultContainer.classList.remove('active');
            } finally {
                clearInterval(timerInterval);
                statusDiv.classList.remove('active');
                if (isVerified) {
                    submitBtn.disabled = false;
                }
            }
        });

        async function initializeAvailableModels() {
            try {
                const response = await fetch('/config');
                if (!response.ok) {
                    throw new Error(`Server responded with status: ${response.status}`);
                }
                const config = await response.json();

                // Hide or show model groups based on server configuration
                openaiOptgroup.style.display = config.openai ? '' : 'none';
                geminiOptgroup.style.display = config.gemini ? '' : 'none';

                // Handle the case where no models are available at all
                if (!config.openai && !config.gemini) {
                    modelSelect.innerHTML = '<option value="">æ— å¯ç”¨æ¨¡å‹</option>';
                    modelSelect.disabled = true;
                    voiceSelect.disabled = true;
                    submitBtn.disabled = true;
                    alert('é”™è¯¯ï¼šæœåŠ¡å™¨æœªé…ç½®ä»»ä½•TTSæ¨¡å‹APIå¯†é’¥ã€‚è¯·è”ç³»ç®¡ç†å‘˜ã€‚');
                    return; // Stop further processing
                }

                // If the currently selected model is now hidden, select the first available one
                const selectedOption = modelSelect.options[modelSelect.selectedIndex];
                if (selectedOption.parentElement.style.display === 'none') {
                    const firstVisibleOption = modelSelect.querySelector('option:not([disabled])');
                    if(firstVisibleOption) {
                        modelSelect.value = firstVisibleOption.value;
                    }
                }
                
                // Finally, refresh the voice list for the correctly selected model
                refreshVoices();

            } catch (error) {
                console.error("Failed to load model configuration:", error);
                alert("æ— æ³•åŠ è½½æ¨¡å‹é…ç½®ï¼ŒæŸäº›æ¨¡å‹å¯èƒ½æ— æ³•ä½¿ç”¨ã€‚è¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚");
                // We can let the user proceed, but they might encounter errors.
            }
        }
        const geminiTip = document.getElementById('gemini-style-tip');
        function toggleGeminiTip() {
            if (!geminiTip) return;
            const isGemini = (modelSelect.value || '').startsWith('gemini');
            geminiTip.classList.toggle('hidden', !isGemini);
        }
        // åˆå§‹ä¸å˜æ›´æ—¶æ£€æŸ¥ï¼ˆä¸å½±å“ä½ ç°æœ‰çš„ refreshVoices é€»è¾‘ï¼‰
        toggleGeminiTip();
        modelSelect.addEventListener('change', toggleGeminiTip);

        // â€”â€” ä¸€é”®å‰ç¼€ï¼šæŠŠ chip çš„ data-style å‰ç½®åˆ°æ–‡æœ¬æ¡† â€”â€” 
        geminiTip?.addEventListener('click', (e) => {
            const btn = e.target.closest('.chip');
            if (!btn) return;
            const prefix = btn.getAttribute('data-style') || '';
            const current = textInput.value || '';
            textInput.value = current.startsWith(prefix) ? current : (prefix + current);
            textInput.focus();
        });

        // â€”â€” ç¤ºä¾‹æ’å…¥åˆ°ä¸»æ–‡æœ¬æ¡† â€”â€” 
        geminiTip?.querySelectorAll('.example-insert').forEach(btn => {
            btn.addEventListener('click', () => {
            const ta = btn.closest('.example-box')?.querySelector('.example');
            if (ta) {
                textInput.value = ta.value.trim();
                textInput.focus();
            }
            });
        });

        // â€”â€” å¤åˆ¶ç¤ºä¾‹åˆ°å‰ªè´´æ¿ï¼ˆå¸¦å›é€€ï¼‰ â€”â€” 
        geminiTip?.querySelectorAll('.example-copy').forEach(btn => {
            btn.addEventListener('click', async () => {
            const ta = btn.closest('.example-box')?.querySelector('.example');
            if (!ta) return;
            try {
                await navigator.clipboard.writeText(ta.value.trim());
                const old = btn.textContent;
                btn.textContent = 'å·²å¤åˆ¶';
                setTimeout(() => (btn.textContent = old), 1200);
            } catch {
                ta.select(); // å›é€€ï¼šé€‰ä¸­æ–‡æœ¬ï¼Œæç¤ºç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶
            }
            });
        });

        // Initial check
        initializeAvailableModels();
        checkAuthStatus();
        charCountDiv.textContent = `0`; // Initialize char count
    </script>
</body>

</html>